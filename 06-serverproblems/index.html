

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" href="/img/avatar.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="BlissfulAlloy79">
  <meta name="keywords" content="">
  
    <meta name="description" content="开服时所遇到的各种奇奇怪怪的大小问题">
<meta property="og:type" content="article">
<meta property="og:title" content="开服时各种疑难杂症合集">
<meta property="og:url" content="https://blissfulalloy79.github.io/06-serverproblems/index.html">
<meta property="og:site_name" content="BlissfulAlloy&#39;s Blog">
<meta property="og:description" content="开服时所遇到的各种奇奇怪怪的大小问题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blissfulalloy79.github.io/img/06-serverproblems/console_language.png">
<meta property="article:published_time" content="2023-06-29T00:59:34.000Z">
<meta property="article:modified_time" content="2024-08-24T01:28:57.997Z">
<meta property="article:author" content="BlissfulAlloy79">
<meta property="article:tag" content="服务器">
<meta property="article:tag" content="合集">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blissfulalloy79.github.io/img/06-serverproblems/console_language.png">
  
  
  
  <title>开服时各种疑难杂症合集 - BlissfulAlloy&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blissfulalloy79.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":false,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>BlissfulAlloy79&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-bilibili-fill"></i>
                <span>ACGN</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/bangumis/" target="_self">
                    <i class="iconfont icon-bilibili-fill"></i>
                    <span>冻鳗与书籍</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/steamgames/" target="_self">
                    <i class="iconfont icon-steam"></i>
                    <span>Steam</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="开服时各种疑难杂症合集"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        BlissfulAlloy79
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-28 20:59" pubdate>
          2023年6月28日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          19 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">开服时各种疑难杂症合集</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年8月23日 晚上
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>开服时所遇到的各种奇奇怪怪的大小问题</p>
<span id="more"></span>
<h1>序</h1>
<blockquote>
<p>就像我在<a target="_blank" rel="noopener" href="https://blissfulalloy79.lazycraft.top/about/#%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2%EF%BC%9A" title="关于博客">关于博客</a>里所说的，内容以分享经验为主</p>
<p>当了那么久腐竹，一定会遇到不少疑难杂症，但不少都是些奇奇怪怪的小问题并且年代久远，久而久之就忘了该如何解决</p>
<p>所以这个合集的目的就是做一个收录，把遇到的情况和解决方案留下来，下次遇到同样的就不用再花时间去慢慢 debug</p>
</blockquote>
<h2 id="系统信息">系统信息</h2>
<p>可惜，咱服务器上因为种种原因跑的不是 Linux, 而是 Windows Server</p>
<p>版本为 Windows Server 2022</p>
<h1>无法使用 KMS 或者 OEM 激活 Windows Server</h1>
<p>Windows Server 系统安装完成后，尝试 KMS 或者 OEM 均无法激活</p>
<p>激活工具：<a target="_blank" rel="noopener" href="https://github.com/zbezj/HEU_KMS_Activator">HEU_KMS_Activator</a></p>
<h2 id="成因">成因</h2>
<p>选择 Windows Server 镜像的时候选择了 Evaluation 版本，这个不容易发现</p>
<p>使用 Eval 版本的 Windows Server 都无法被激活</p>
<h2 id="修复">修复</h2>
<p>使用 <a target="_blank" rel="noopener" href="https://github.com/massgravel/Microsoft-Activation-Scripts">MAS</a> 修改版本</p>
<ol>
<li class="lvl-3">
<p>启动 Powershell，输入</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">irm</span> https://massgrave.dev/get | <span class="hljs-built_in">iex</span><br></code></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p>在弹出来的窗口选择第 7 项，再在新页面选择第一项修改版本</p>
</li>
<li class="lvl-3">
<p>修改成 Standard 而并非 Eval</p>
</li>
<li class="lvl-3">
<p>重启电脑，现在再次尝试使用 KMS 或 OEM 都能激活</p>
</li>
</ol>
<p>完成</p>
<blockquote>
<p>顺带一提，修改完版本后可以任意选择使用 MAS 或者 HEU 激活，都一样的，无所谓</p>
<p>MAS 和 HEU 都是非常好用的激活工具 ┗|｀O′|┛</p>
</blockquote>
<h1>安装 Windows Terminal 报错</h1>
<p>根据<a target="_blank" rel="noopener" href="https://github.com/microsoft/terminal/discussions/13983"> github 上的这个教程</a>在 Windows Server 上安装 Windows Terminal</p>
<p>在 Powershell 安装 VCLibs 没问题，但是安装 Windows Terminal 的时候就报错</p>
<p>内容如下</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs console">Add-AppxPackage : Deployment failed with HRESULT: 0x80073CF3, Package failed updates, dependency or conflict validation.<br>Windows cannot install package Microsoft.DesktopAppInstaller_1.17.3411.0_x64__8wekyb3d8bbwe because this package depends on a framework that could not be found. Provide the framework<br>&quot;Microsoft.UI.Xaml.2.7&quot; published by &quot;CN=Microsoft Corporation, O=Microsoft Corporation, L=Redmond, S=Washington, C=US&quot;, with neutral or x64 processor architecture and minimum version<br>7.2109.13004.0, along with this package to install. The frameworks with name &quot;Microsoft.UI.Xaml.2.7&quot; currently installed are: &#123;&#125;<br>NOTE: For additional information, look for [ActivityId] 5730573a-07cf-000f-f88c-3057cf07d801 in the Event Log or use the command line Get-AppPackageLog -ActivityID<br>5730573a-07cf-000f-f88c-3057cf07d801<br>At line:1 char:1<br>+ Add-AppxPackage .\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe.msixbun ...<br>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>    + CategoryInfo          : WriteError: (C:\Users\WDAGUt...bbwe.msixbundle:String) [Add-AppxPackage], IOException<br>    + FullyQualifiedErrorId : DeploymentError,Microsoft.Windows.Appx.PackageManager.Commands.AddAppxPackageCommand<br></code></pre></td></tr></table></figure>
<h2 id="成因-2">成因</h2>
<p>如果仔细看报错信息，会发现这个错误是指缺失了 <code>Microsoft.UI.Xaml.2.7</code> 这个软件包</p>
<h2 id="修复-2">修复</h2>
<p>有俩种方法修复，一种就是直接 ignore 掉这个 dependency，另外一种就是安装这个所需的包</p>
<h3 id="Ignore-dependency">Ignore dependency</h3>
<p>参考<a target="_blank" rel="noopener" href="https://github.com/microsoft/winget-cli/issues/3918"> github 上的这个 issue</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">winget install Microsoft.WindowsTerminal <span class="hljs-literal">--skip-dependencies</span><br></code></pre></td></tr></table></figure>
<p>问题解决，或</p>
<h3 id="安装-Microsoft-UI-Xaml">安装 <code>Microsoft.UI.Xaml</code></h3>
<p>参考<a target="_blank" rel="noopener" href="https://github.com/microsoft/winget-cli/issues/1861">另外一个 github issue</a></p>
<ol>
<li class="lvl-3">
<p>下载一个 NuGetPackage：<a target="_blank" rel="noopener" href="https://www.nuget.org/packages/Microsoft.UI.Xaml/">https://www.nuget.org/packages/Microsoft.UI.Xaml/</a></p>
</li>
<li class="lvl-3">
<p>解压这个包（可以把文件扩展名改成 zip）</p>
</li>
<li class="lvl-3">
<p>前往 <code>.\tools\AppX\&#123;arch&#125;\Release\Microsoft.UI.Xaml.2.7.appx</code> 并将这个文件提取出来</p>
</li>
<li class="lvl-3">
<p>启动 Powershell，执行</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Add-AppxPackage</span> <span class="hljs-literal">-Path</span> .\Microsoft.UI.Xaml.<span class="hljs-number">2.7</span>.appx (或者文件所在位置)<br></code></pre></td></tr></table></figure>
<p>问题解决</p>
<h1>服务器控制台以及日志无法正确显示中文</h1>
<p>控制台以及日志可以正确显示中文，但是某些时候还是会变成 <code>?</code> 或者其他错误字符</p>
<p><img src="/img/06-serverproblems/console_language.png" srcset="/img/loading.gif" lazyload alt="示例"></p>
<p>这个图片中发送的是 <code>测试</code> ，但在控制台中却显示为 <code>??</code></p>
<p>同时，上面的字段证明了控制台是可以显示中文</p>
<h2 id="成因-3">成因</h2>
<p>其实这是 Windows 系统默认编码造成的</p>
<p>在上面那个示例中，系统是 Windows Server，安装语言为英文</p>
<p>安装系统语言是英文的话默认编码就不是 <code>utf-8</code>，而是其他的编码</p>
<p>不过在截图中能看到，上方程序的编码解码已经设置为 <code>utf-8</code> ，但是为何下面的中文仍然无法正确显示</p>
<p>其实这是一个误解</p>
<p>上方的输出属于 MCDR ，而最下面那行是 mc 服务器的输出，二者并非同一程序，编码规则当然毫无关联</p>
<p>只是 MCDR 的编码设置为 <code>utf-8</code> ，而 mc 服务器的话并没有指定，当调用系统默认编码时不是  unicode 的话自然就无法正确显示中文</p>
<h2 id="修复-3">修复</h2>
<p>前往 <code>控制面板</code> -&gt; <code>更改日期，时间或数字格式</code> -&gt; <code>管理</code> -&gt; <code>更改系统区域设置...</code></p>
<p>勾取 <code>Beta版：使用 Unicode UTF-8 提供全球语言支持</code></p>
<p>英文系统也是对应的：</p>
<p><code>Control Panel</code> -&gt; <code>Change date, time, or number formats</code> -&gt; <code>Administrative</code> -&gt; <code>Change system locale...</code></p>
<p>勾取 <code>Beta: Use Unicode UTF-8 for worldwide language support</code></p>
<p>重启系统</p>
<p>问题解决</p>
<p>现在控制台应该能正常显示中文或者其他语言了 q(≧▽≦q)</p>
<h1>无法连接本地服务器</h1>
<p>在和服务器同一个网络下，无论如何都无法连接</p>
<p>服务器防火墙已经全部关闭，无任何杀毒软件阻碍</p>
<p>使用其他方式（例如 Bungeecord）却能够连接</p>
<h2 id="成因-4">成因</h2>
<p>其实问题很简单，但是非常容易被忽略</p>
<p>在服务器 <code>server.properties</code> 里有一项叫做 <code>server-ip</code> 的选项，很多时候填不填写并无大碍，通常会写上 <code>127.0.0.1</code> ，合情合理</p>
<p>但是在 Minecraft 的机制里，<code>server-ip</code> 是指将服务器与这个 ip 绑定，填写完后服务器将只会监听来自这个 ip 的连接</p>
<p>所以，在填写 <code>127.0.0.1</code> 之后，服务器就只会回应来自本地的连接（恍然大悟</p>
<p>但是，为什么使用 Bungeecord 却能够连接呢？</p>
<p>因为我是原版服务端，所以在 Bungeecord config 里 <code>ip_forward</code> 是设为 <code>false</code> ，细心留意的话会发现通过 Bungeecord 建立的连接在服务端里显示的都是 <code>127.0.0.1</code> ，因此通过 Bungeecord 来连接服务器的并不会因为 <code>server.properties</code> 的 <code>server-ip</code> 选项阻挠</p>
<h2 id="修复-4">修复</h2>
<p>按照建议将 <code>server.properties</code> 里的 <code>server-ip</code> 留空</p>
<p>重启服务器</p>
<h1>某个机器的 Python 程序无法 import 所需库</h1>
<p>在正常 import 了所有 library 情况下却报 <code>ImportError</code></p>
<blockquote>
<p>注意，是 <code>ImportError</code> 而不是 <code>ModuleNotFoundError</code></p>
</blockquote>
<p>这种情况下用 <code>pip list</code> 能够看到所需的 library，但是无论如何 <code>pip uninstall</code> 再 <code>pip install</code> 都无法解决</p>
<p>还有，这种情况是在某个程序出现的，其他 python 程序没问题</p>
<p>另外，只有「干净」，没乱装东西的 Server 环境才有这个问题，Desktop 开发环境使用同样的步骤 <code>pip install</code> 安装却无法复现相关问题</p>
<p>最多也只是卸载了所需的库导致 <code>ModuleNotFoundError</code>，而并非 <code>ImportError</code></p>
<blockquote>
<p>完整报错：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs console">ImportError: DLL load failed while importing ujson: The specified module could not be found.<br></code></pre></td></tr></table></figure>
</blockquote>
<h2 id="成因-5">成因</h2>
<p>其实具体成因我目前阶段无法给出答案</p>
<p>但是如果仔细看报错的话，是 DLL 相关的问题</p>
<p>况且上面背景也交代了若是缺失所需库的话应该是 <code>ModuleNotFoundError</code>，表示问题不在 library 上面</p>
<p>Windows 上 DLL 相关的问题也几乎只有一个解决方案，装个 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist?view=msvc-170#latest-microsoft-visual-c-redistributable-version">Microsoft Visucal C++ Redist</a> 即可</p>
<p>这也解释了为什么我的 Desktop 开发环境无法复现问题，因为在开发途中装了太多乱七八糟的玩意，而在检查 windows 安装软件里雀食是已经有 MS Visual C++ Redist</p>
<p>反而干净的 Server 里啥也没有，所以导致了缺失 DLL 的问题</p>
<h2 id="修复-5">修复</h2>
<p>安装最新的 <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist?view=msvc-170#latest-microsoft-visual-c-redistributable-version">Microsoft Visucal C++ Redist</a> 即可</p>
<h1>无法成功设置 Nginx Docker Image</h1>
<p>以前我是直接 bare metal 跑 Nginx 反代，用系统服务设置开机自启动，但是某次在重装之后有些手贱想试试用 Docker container 的形式来跑 Nginx，~~(我 tm 真的想杀掉那会的自己</p>
<p>按照 bare metal 的形式设置 nginx，但是一直无法建立连接，config 确认没有问题，直接用服务器 ip + 端口访问其他 container 服务均无问题</p>
<p>部分 nginx config 如下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>	<span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>	<span class="hljs-attribute">server_name</span> example.lazycraft.top;<br>	...<br>	<span class="hljs-section">location</span> &#123;<br>		<span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>某个 docker container 的服务暴露在 8080 端口，假设服务器 ip 为 <code>192.168.68.2</code>，使用 <code>192.168.68.2:8080</code> 可以正常访问</p>
<p>这个设置在之前直接把 nginx 注册为 windows server 系统服务时可用，访问 example.lazycraft.top 没有问题</p>
<p>但是现在在 docker 里的 nginx 这样设置就无法访问</p>
<h2 id="成因-6">成因</h2>
<p>十分简单，只要了解 container 的本质即可</p>
<p>按照 <a target="_blank" rel="noopener" href="https://docs.docker.com/get-started/overview/#the-docker-platform">docs.docker.com</a> 所述</p>
<blockquote>
<p>Docker provides the ability to package and run an application in a loosely isolated environment called a container. The isolation and security lets you run many containers simultaneously on a given host. Containers are lightweight and contain everything needed to run the application, so you don’t need to rely on what’s installed on the host. You can share containers while you work, and be sure that everyone you share with gets the same container that works in the same way.</p>
</blockquote>
<p>所有 container 在 docker 里都是被某种程度上隔离的，包括网络层</p>
<p>用户可以自己去管理 docker 上的网络，但是在很多时候下 image 来跑的时候并不会专门设置网络，而且 docker 也会自动帮你管理网络，这一点很多时候就被忽略掉了</p>
<p>在隔离的状态下，一个 container 的网络无法访问另外一个</p>
<p>例如，A 软件跑在 A container 里，而 B 软件跑在 B 的container 里</p>
<p>这种情况下 A 软件无法访问 B，反过来也一样</p>
<p>那该如何解决这个隔离问题呢？</p>
<h2 id="修复-6">修复</h2>
<p>同样引用官网所述，这些环境是 <em>loosely isolated</em>，用户在某种程度上来说是可以让这些软件去调用读取 host 的文件或者信息的</p>
<p>例如文件，用户可以在 deploy images 的时候或者在 <code>docker-compose.yml</code> 里建立文件映射，把某个本地的文件目录映射到 container 里的目录</p>
<p>网络也同理，用户可以通过手动管理 docker 网络来达到不同的 container 相互访问</p>
<ol>
<li class="lvl-3">
<p>建立 docker 网络</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker network create homeserver_network<br></code></pre></td></tr></table></figure>
</li>
<li class="lvl-3">
<p>把不同的 container 添加到这个网络里</p>
<p>检查 container 名称</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker <span class="hljs-built_in">ps</span><br></code></pre></td></tr></table></figure>
<p>添加 container</p>
 <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">docker network connect homeserver_network &lt;container1&gt;<br>docker network connect homeserver_network &lt;container2&gt;<br>...<br></code></pre></td></tr></table></figure>
<p><code>&lt;container1&gt;</code> 和 <code>&lt;container2&gt;</code> 可以是 container name 或者 ID</p>
</li>
<li class="lvl-3">
<p>添加完成后，设置 Nginx config</p>
<p>举个例子，我想透过 docker1.lazycraft.top 来访问位于 container1 的服务</p>
<p>container1 的端口映射为 8000（container 的） -&gt; 8080（host 暴露的）</p>
<p>config 内容应为如下</p>
 <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nginx">events&#123;&#125;<br><br><span class="hljs-section">http</span> &#123;<br>	<span class="hljs-section">server</span> &#123;<br>		<span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>; <span class="hljs-comment"># 尝龟监听端口</span><br>		<br>		<span class="hljs-section">location</span> / &#123;<br>			<span class="hljs-comment"># 注意这里</span><br>			<span class="hljs-attribute">proxy_pass</span> http://container1:8000;<br>			<span class="hljs-comment"># ip/地址 栏就填 container 名字，也就是第 2 步添加的名字</span><br>			<span class="hljs-comment"># 端口栏填写的**不是** host 所暴露的端口，而是 container 本身的端口</span><br>			<span class="hljs-comment"># 因为这一切都还在 docker 的虚拟机里</span><br>			<span class="hljs-comment"># 按照例子，这里要填的是 8000，而不是 8080</span><br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
</ol>
<p>修改完成，保存设置，并重启 Nginx 服务</p>
<blockquote>
<p>类似的反代理服务例如 <a target="_blank" rel="noopener" href="https://nginxproxymanager.com/">Nginx Proxy Manager</a> 也是同样的道理，通过建立 docker 网络来解决读取的问题</p>
</blockquote>
<hr>
<p>目前就先更到这里，如果后续还发现了一些新的问题和解决方案的话会持续更新的 (●’◡’●)</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="print-no-link">#服务器</a>
      
        <a href="/tags/%E5%90%88%E9%9B%86/" class="print-no-link">#合集</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>开服时各种疑难杂症合集</div>
      <div>https://blissfulalloy79.github.io/06-serverproblems/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>BlissfulAlloy79</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年6月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/07-simplecode01/" title="随手搓 01：MC 物品数据统计">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">随手搓 01：MC 物品数据统计</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/05-hexodeco/" title="Hexo 个人美化合集">
                        <span class="hidden-mobile">Hexo 个人美化合集</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://cdn.staticfile.org/waline/2.15.5/waline.min.css')
      Fluid.utils.createScript('https://cdn.staticfile.org/waline/2.15.5/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://waline-6bmghd4bb-blissfulalloy79.vercel.app/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  

<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<!-- hexo injector body_end start -->
<script type="text/javascript" color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="/js/blacklines.js"></script>
<!-- hexo injector body_end end --></body>
</html>
